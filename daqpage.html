<!DOCTYPE html>
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Pixie-Net MCA</title>

<script type="text/javascript"  src="dygraph-combined.js"></script>
										  
<style type="text/css">
	body { background-color:#d0d0d0; font-family:sans-serif; }
	div.box { background-color:#ffffff; width:500px; margin:20px auto 50px; padding:50px; border-radius:10px; border:1px solid #808080; box-shadow:8px 15px 20px #404040 }
	img.logo { float:right; margin:-10px 0 0 30px }
	h1 { margin:0; font-size:24px }
	h2 { margin-top:40px; font-size:20px; font-weight:normal; border-bottom:1px solid #ff9040 }
	p { font-size:14px }
	a { color:#6060d0; text-decoration:none }
	a:hover { text-decoration:underline }
</style>

<script>
$(document).ready(function(){

	// ------------- button control functions -----------------------

	  $("#refresh").click(function(){		// function for  refresh button

		  $.get("gettraces.cgi", function (data) {		  						//jQuery get function executes gettraces on Pixie-Net -> new ADC.csv
		  	//	alert("Data:  " + data);	    
				  var g2 = new Dygraph(
				    document.getElementById("graphdiv2"),
				    "MCA.csv", // path to CSV file
				    {  // graph options
					  colors:
				            ["Navy", "Maroon",    "DarkMagenta", "Black", 
				             "Blue", "Red",       "BlueViolet",  "Green", 
				             "Teal", "Darkorange","Fuchsia",     "Olive" ,
								 "Aqua", "Gold",      "Gray",        "Lime" ], 
					  title: ' ',
					  ylabel: 'N Counts',
					  xlabel: 'Bin Number',     
					  labelsDiv: document.getElementById('legend'),
				     legend: 'always',
					  // TODO: legendformatter option with updated dygraph dygraph.min.js
					  visibility: [true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true]
					  }
				  );


		 })  		// end get
	  });		   // end button click refresh

	  $("#apply").click(function(){		// function for  refresh button

		  $.get("progfippi.cgi", function (data) {	//jQuery get function executes progfippi on Pixie-Net -> settings file applied
		  		alert(data);	    
		 })  		// end get
	  });		   // end button click refresh


	  $("#read").click(function(){							// function for  read settings button

		  $.get("cgisettings.cgi", function (data) {	   //jQuery get function executes cgisettings on Pixie-Net -> return data is list of analog settings
		  		//alert("Data:  " + data);
			  
			   var dataarray = data.split(',');			  // "split" data string at commas
				//alert("Data[0]:  " + dataarray[0]);

				$("#runtime").val(dataarray[7]);			// assign values to polarity controls
				$("#runtype").val(dataarray[13]);
	
			 })  // end get
	  });		  // end button click read  settings


  	// ------------- control field functions -----------------------


    $(".field").focus(function(){							 // change color of control field while editing
    	$(this).css("background-color", "yellow");
  	 });

	 $(".field").blur(function(){						   
    	$(this).css("background-color", "white");		   // restore color of control field when done editing
	
		 $.get("cgiwriteDAQsettings.cgi", 					 //jQuery get function executes cgisettings on Pixie-Net -> return data is list of analog settings
		 		 {CCSRA_POLARITY_05:"(name)", 
				 		v0:$("#runtime").val(), 
						v1:$("#runtype").val(),
				  },
			     function (data) {	   
		  		alert(data);
			 })  // end get
  	 });  // end blur (deselect)





});	// end document ready


</head>


<body>
 <div id="page" class="box">            
<img src="Xia_LLC_web_header.jpg" width="500" height="80" border="0"></a>
<p> </p>
<p> <h1> Pixie-Net MCA Spectrum </h1></p>

<div id="graphdiv2"  style="width:500px; height:300px; "></div>
<div id = "legend" style="width:500px; height:80px;" ></div>

<input id='read' type="button" value="Read Settings">
<input id='apply' type="button" value="Apply (progfippi)">
<input id='refresh' type="button" value="Refresh MCA">
<input id='start' type="button" value="Start DAQ">
<p> </p>
REQ_RUNTIME <input class="field" type="text" size="8" id="runtime" value="0"> <br>
RUN_TYPE	   <input class="field" type="text" size="8" id="runtype" value="0x400"> <br>
<p> </p>

<script type="text/javascript">

  var g2 = new Dygraph(
    document.getElementById("graphdiv2"),
    "MCA.csv", // path to CSV file
    {  // graph options
	  colors:
            ["Navy", "Maroon",    "DarkMagenta", "Black", 
             "Blue", "Red",       "BlueViolet",  "Green", 
             "Teal", "Darkorange","Fuchsia",     "Olive" ,
				 "Aqua", "Gold",      "Gray",        "Lime" ], 
	  title: ' ',
	  ylabel: 'N Counts',
	  xlabel: 'Bin Number',     
	  labelsDiv: document.getElementById('legend'),
     legend: 'always',
	  // TODO: legendformatter option with updated dygraph dygraph.min.js
	  visibility: [true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true]
	  }
  );

  function change(el) {
  		g2.setVisibility(el.id, el.checked);
  }

   function changeall(el) {				   // todo: update the checkbox status also?
     	g2.setVisibility(0, el.checked);
		g2.setVisibility(1, el.checked);
		g2.setVisibility(2, el.checked);
		g2.setVisibility(3, el.checked);
		g2.setVisibility(4, el.checked);
		g2.setVisibility(5, el.checked);
		g2.setVisibility(6, el.checked);
		g2.setVisibility(7, el.checked);
		g2.setVisibility(8, el.checked);
		g2.setVisibility(9, el.checked);
		g2.setVisibility(10, el.checked);
		g2.setVisibility(11, el.checked);
		g2.setVisibility(12, el.checked);
		g2.setVisibility(13, el.checked);
		g2.setVisibility(14, el.checked);
		g2.setVisibility(15, el.checked);
	  }

      var graphs = [ g2 ];
      var scales = { x : false, y : false };
      function setLogScale(axis, val) {
        if (axis === 'y') {
          for (var idx = 0; idx < graphs.length; idx++) {
            graphs[idx].updateOptions({ logscale: val });
          }
        } else {
          for (var idx = 0; idx < graphs.length; idx++) {
            graphs[idx].updateOptions({ axes : { x : {  logscale : val } } });
          }
        }
        scales[axis] = val;
        var text = "y: " + (scales.y ? "log" : "linear") + ", x: " + (scales.x ? "log" : "linear");
        document.getElementById("description").innerText = text;
      }

      setLogScale('y', false); 
 		
		
      function showall(val) {
         for (var idx = 0; idx < graphs.length; idx++) {	  
            graphs[idx].updateOptions({ 	  visibility: [val, val, val, val, val, val, val, val, val, val, val, val, val, val, val, val] });
         }
		};


</script>
<div id="boxes">
<input id='ylog' type="button" value="y log scale" onclick="setLogScale('y', true)">
<input id='ylinear' type="button" value="y linear scale" onclick="setLogScale('y', false)">
<input id='showall' type="button" value="Show All" onclick="showall(true)">
<input id='showall' type="button" value="Hide All" onclick="showall(false)">

    <p><b>Show</b></p>
    <p>
      <input type="checkbox" id="0" checked="checked"  onclick="change(this)">
      <label for="0"> mca00 </label>
      <input type="checkbox" id="1" checked="checked" onclick="change(this)">
      <label for="1"> mca01 </label>
      <input type="checkbox" id="2" checked="checked" onclick="change(this)">
      <label for="2"> mca02 </label>
		<input type="checkbox" id="3" checked="checked" onclick="change(this)">
      <label for="3"> mca03 </label><br>

		<input type="checkbox" id="4" checked="checked"  onclick="change(this)">
      <label for="0"> mca04 </label>
      <input type="checkbox" id="5" checked="checked" onclick="change(this)">
      <label for="1"> mca05 </label>
      <input type="checkbox" id="6" checked="checked" onclick="change(this)">
      <label for="2"> mca06 </label>
		<input type="checkbox" id="7" checked="checked" onclick="change(this)">
      <label for="3"> mca07 </label><br>

		<input type="checkbox" id="8" checked="checked"  onclick="change(this)">
      <label for="0"> mca08 </label>
      <input type="checkbox" id="9" checked="checked" onclick="change(this)">
      <label for="1"> mca09 </label>
      <input type="checkbox" id="10" checked="checked" onclick="change(this)">
      <label for="2"> mca10 </label>
		<input type="checkbox" id="11" checked="checked" onclick="change(this)">
      <label for="3"> mca11 </label><br>

		<input type="checkbox" id="12" checked="checked"  onclick="change(this)">
      <label for="0"> mca12 </label>
      <input type="checkbox" id="13" checked="checked" onclick="change(this)">
      <label for="1"> mca13 </label>
      <input type="checkbox" id="14" checked="checked" onclick="change(this)">
      <label for="2"> mca14 </label>
		<input type="checkbox" id="15" checked="checked" onclick="change(this)">
      <label for="3"> mca15 </label><br>
    </p>
	 </div>

 </div>

<p>Double click to auto zoom </p>
<p>Click and drag to zoom </p>
<p>Alt click and drag to pan </p>
<p>Use browser button to refresh </p>



</body>
</html>