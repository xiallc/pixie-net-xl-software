<!DOCTYPE html>
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Pixie-Net Setup</title>

<script type="text/javascript"  src="dygraph-combined.js"></script>
<script src="jquery-3.4.1.min.js"></script>

<style type="text/css">
	body { background-color:#d0d0d0; font-family:sans-serif; }
	div.box { background-color:#ffffff; width:500px; margin:20px auto 50px; padding:50px; border-radius:10px; border:1px solid #808080; box-shadow:8px 15px 20px #404040 }
	img.logo { float:right; margin:-10px 0 0 30px }
	h1 { margin:0; font-size:24px }
	h2 { margin-top:40px; font-size:20px; font-weight:normal; border-bottom:1px solid #ff9040 }
	p { font-size:14px }
	th { font-size:12px }
	td { font-size:12px }
	a { color:#6060d0; text-decoration:none }
	a:hover { text-decoration:underline }
</style>

<script>
$(document).ready(function(){

	// ------------- button control functions -----------------------

	  $("#refresh").click(function(){		// function for  refresh button

		  $.get("gettraces.cgi", function (data) {		  						//jQuery get function executes gettraces on Pixie-Net -> new ADC.csv
		  	//	alert("Data:  " + data);	    
			 	var g2 = new Dygraph( 												   // and then recreates the plot in graphdiv2
							    document.getElementById("graphdiv2"),
							    "ADC.csv", // path to CSV file
							    {   // graph options
								  title: ' ',
								  colors:
							            ["Navy", "Maroon",    "DarkMagenta", "Black", 
							             "Blue", "Red",       "BlueViolet",  "Green", 
							             "Teal", "Darkorange","Fuchsia",     "Olive" ,
											 "Aqua", "Gold",      "Gray",        "Lime" ], 
								  ylabel: 'ADC value',
								  xlabel: 'Sample number',          
								  labelsDiv: document.getElementById('legend'),
							     legend: 'always',
								  visibility: [true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true]
								 }
							  );


		 })  		// end get
	  });		   // end button click refresh

	  $("#apply").click(function(){		// function for  apply button
		  $("#apply").css("background-color", "lightgray");
		  $("#read").css("background-color", "lightgray");
		  $("#refresh").css("background-color", "lightgray");
		  $("#hide").css("background-color", "lightgray");
		  $.get("progfippi.cgi", function (data) {	//jQuery get function executes progfippi on Pixie-Net -> settings file applied
		  		alert(data);	    
		 })  		// end get
	  });		   // end button click refresh


	  $(".readbutton").click(function(){							// function for  read settings button

		  $.get("cgireadsettings.cgi", function (data) {	   //jQuery get function executes cgireadsettings on Pixie-Net -> return data is list of analog settings
		  		//alert("Data:  " + data);
			  
			   var dataarray = data.split(',');			  // "split" data string at commas
				//alert("Data[0]:  " + dataarray[0]);

				$("#polarity00").val(dataarray[7]);			// assign values to polarity controls
				$("#polarity01").val(dataarray[13]);
				$("#polarity02").val(dataarray[19]);
				$("#polarity03").val(dataarray[25]);
				$("#polarity04").val(dataarray[31]);
				$("#polarity05").val(dataarray[37]);
				$("#polarity06").val(dataarray[43]);
				$("#polarity07").val(dataarray[49]);

				$("#offset00").val(dataarray[8]);			// assign values to offset controls
				$("#offset01").val(dataarray[14]);
				$("#offset02").val(dataarray[20]);
				$("#offset03").val(dataarray[26]);
				$("#offset04").val(dataarray[32]);
				$("#offset05").val(dataarray[38]);
				$("#offset06").val(dataarray[44]);
				$("#offset07").val(dataarray[50]);

				$("#again00").val(dataarray[9]);			  	// assign values to analog gain controls
				$("#again01").val(dataarray[15]);
				$("#again02").val(dataarray[21]);
				$("#again03").val(dataarray[27]);
				$("#again04").val(dataarray[33]);
				$("#again05").val(dataarray[39]);
				$("#again06").val(dataarray[45]);
				$("#again07").val(dataarray[51]);

			   $("#dgain00").val(dataarray[10]);			  	// assign values to analog gain controls
				$("#dgain01").val(dataarray[16]);
				$("#dgain02").val(dataarray[22]);
				$("#dgain03").val(dataarray[28]);
				$("#dgain04").val(dataarray[34]);
				$("#dgain05").val(dataarray[40]);
				$("#dgain06").val(dataarray[46]);
				$("#dgain07").val(dataarray[52]);

				$("#tau00").val(dataarray[11]);				 // assign values to tau controls
				$("#tau01").val(dataarray[17]);
				$("#tau02").val(dataarray[23]);
				$("#tau03").val(dataarray[29]);
				$("#tau04").val(dataarray[35]);
				$("#tau05").val(dataarray[41]);
				$("#tau06").val(dataarray[47]);
				$("#tau07").val(dataarray[53]);
	
			 })  // end get
			 $("#read1").css("background-color", "green");
	  });		  // end button click read  settings


	  $("#apply1").click(function(){		// function for  initialization apply button
	     $.get("progfippi.cgi", function (data) {	//jQuery get function executes progfippi on Pixie-Net -> settings file applied
		  		alert(data);	
    		   
		 })  		// end get
		 $(this).css("background-color", "green");
	  });		   // end button click refresh

 	  $("#boot1").click(function(){		// function for  initialization boot button
		  alert("Please wait for next confirmation box");
		  $.get("bootfpga.cgi", function (data) {	//jQuery get function executes bootfpga on Pixie-Net 
		  		alert(data);
	    	  
		 })  		// end get
		 $(this).css("background-color", "green");
	  });		   // end button click refresh

	 $("#hide").click(function(){		// hide extra controls  
	    $("#first").toggle();
		 $("#row08").toggle();
		 	alert("click");
	  });		   // end checkbox click 



  	// ------------- control field functions -----------------------


    $(".fieldp").focus(function(){							 // change color of control field while editing
    	$(this).css("background-color", "yellow");
		$("#apply").css("background-color", "yellow");
  	 });

	 $(".fieldp").blur(function(){						   
    	$(this).css("background-color", "white");		   // restore color of control field when done editing
	
		 $.get("cgiwritesettings.cgi", 					 //jQuery get function executes cgiwritesettings on Pixie-Net -> webpage values saved to ini file
		 		 {CCSRA_POLARITY_05:"CHANNEL", 
				 		v0:$("#polarity00").val(), 
						v1:$("#polarity01").val(),
 					   v2:$("#polarity02").val(),
						v3:$("#polarity03").val(),
						v4:$("#polarity04").val(),
						v5:$("#polarity05").val(),
						v6:$("#polarity06").val(),
						v7:$("#polarity07").val()
				  },
			     function (data) {	   
		  		alert(data);
			 })  // end get
  	 });  // end blur (deselect)

    $(".fieldo").focus(function(){							 // change color of control field while editing
    	$(this).css("background-color", "yellow");
		$("#apply").css("background-color", "yellow");
  	 });

	 $(".fieldo").blur(function(){						   
    	$(this).css("background-color", "white");		   // restore color of control field when done editing
	
		 $.get("cgiwritesettings.cgi", 					 //jQuery get function executes cgiwritesettings on Pixie-Net -> webpage values saved to ini file
		 		 {VOFFSET:"CHANNEL", 
				 		v0:$("#offset00").val(), 
						v1:$("#offset01").val(),
 					   v2:$("#offset02").val(),
						v3:$("#offset03").val(),
						v4:$("#offset04").val(),
						v5:$("#offset05").val(),
						v6:$("#offset06").val(),
						v7:$("#offset07").val()
				  },
			     function (data) {	   
		  		alert(data);
			 })  // end get
  	 });  // end blur (deselect)

    $(".fielda").focus(function(){							 // change color of control field while editing
	     	$(this).css("background-color", "yellow");
  	 	   $("#apply").css("background-color", "yellow");
	 });

	 $(".fielda").blur(function(){						   
    	$(this).css("background-color", "white");		   // restore color of control field when done editing
	
		 $.get("cgiwritesettings.cgi", 					 //jQuery get function executes cgiwritesettings on Pixie-Net -> webpage values saved to ini file
		 		 {ANALOG_GAIN:"CHANNEL", 
				 		v0:$("#again00").val(), 
						v1:$("#again01").val(),
 					   v2:$("#again02").val(),
						v3:$("#again03").val(),
						v4:$("#again04").val(),
						v5:$("#again05").val(),
						v6:$("#again06").val(),
						v7:$("#again07").val()
				  },
			     function (data) {	   
		  		alert(data);
			 })  // end get
  	 });  // end blur (deselect)
	 
    $(".fieldd").focus(function(){							 // change color of control field while editing
    	$(this).css("background-color", "yellow");
		$("#apply").css("background-color", "yellow");
  	 });

	 $(".fieldd").blur(function(){						   
    	$(this).css("background-color", "white");		   // restore color of control field when done editing
	
		 $.get("cgiwritesettings.cgi", 					 //jQuery get function executes cgiwritesettings on Pixie-Net -> webpage values saved to ini file
		 		 {DIG_GAIN:"CHANNEL", 
				 		v0:$("#dgain00").val(), 
						v1:$("#dgain01").val(),
 					   v2:$("#dgain02").val(),
						v3:$("#dgain03").val(),
						v4:$("#dgain04").val(),
						v5:$("#dgain05").val(),
						v6:$("#dgain06").val(),
						v7:$("#dgain07").val()
				  },
			     function (data) {	   
		  		alert(data);
			 })  // end get
  	 });  // end blur (deselect)

    $(".fieldt").focus(function(){							 // change color of control field while editing
    	$(this).css("background-color", "yellow");
		$("#apply").css("background-color", "yellow");
  	 });

	 $(".fieldt").blur(function(){						   
    	$(this).css("background-color", "white");		   // restore color of control field when done editing
	
		 $.get("cgiwritesettings.cgi", 					 //jQuery get function executes cgiwritesettings on Pixie-Net -> webpage values saved to ini file
		 		 {TAU:"CHANNEL", 
				 		v0:$("#tau00").val(), 
						v1:$("#tau01").val(),
 					   v2:$("#tau02").val(),
						v3:$("#tau03").val(),
						v4:$("#tau04").val(),
						v5:$("#tau05").val(),
						v6:$("#tau06").val(),
						v7:$("#tau07").val()
				  },
			     function (data) {	   
		  		alert(data);
			 })  // end get
  	 });  // end blur (deselect)

   	// ------------- checkbox functions -----------------------





});	// end document ready



</script>

</head>


<body>

<body>
 <div class="box">            
<img src="Xia_LLC_web_header.jpg" width="500" height="80" border="0"></a>
<p> </p>
<p> <h1> Pixie-Net XL ADC Setup </h1></p>

<div id="first">
Initialize: 
<input id='boot1' type="button" value="Boot FPGA">
<input id='apply1' type="button" value="Program FPGA">
<input id='read1' class='readbutton' type="button" value="Read Settings">
</div>



<div id="graphdiv2"  style="width:500px; height:300px;"></div> 
<div id = "legend" style="width:500px; height:80px;" ></div>


<input id='read' class='readbutton' type="button" value="Read Settings">
<input id='apply' type="button" value="Apply (progfippi)">
<input id='refresh' type="button" value="Refresh Traces">
<input id='hide' type="button" value="Show/Hide More">

 <p> </p>

<table style="width:100%">
<tr> <th>Channel</th> <th>Inverted</th> <th>Offset</th>   <th>Analog Gain</th>   <th>Digital Gain</th>  <th>Tau</th> <th>Show</th>	  </tr>
<tr id=row00> <td>00  </td>
	  <td> <input class="fieldp" type="text" size="8" id="polarity00" value="0"> </td>
     <td> <input class="fieldo" type="text" size="8" id="offset00" value="0.000"> </td>
     <td> <input class="fielda" type="text" size="8" id="again00" value="0.000">  </td>
	  <td> <input class="fieldd" type="text" size="8" id="dgain00" value="0.000">  </td>
	  <td> <input class="fieldt" type="text" size="8" id="tau00" value="0.000">   </td> 
	  <td> <input type="checkbox" id="0" checked="checked"  onclick="change(this)"></td> </tr>
<tr id=row01> <td>01</td>
     <td> <input class="fieldp" type="text" size="8" id="polarity01" value="0"> </td>
	  <td> <input class="fieldo" type="text" size="8" id="offset01" value="0.000">  </td>
     <td> <input class="fielda" type="text" size="8" id="again01" value="0.000"> </td>
	  <td> <input class="fieldd" type="text" size="8" id="dgain01" value="0.000">  </td>
	  <td> <input class="fieldt" type="text" size="8" id="tau01" value="0.000"></td> 
	  <td> <input type="checkbox" id="1" checked="checked"  onclick="change(this)"> </td> </tr>
<tr id=row02> <td>02 </td>
	  <td> <input class="fieldp" type="text" size="8" id="polarity02" value="0"> </td>
	  <td> <input class="fieldo" type="text" size="8" id="offset02" value="0.000">	</td>
     <td> <input class="fielda" type="text" size="8" id="again02" value="0.000"> </td>
	  <td> <input class="fieldd" type="text" size="8" id="dgain02" value="0.000">  </td>
	  <td> <input class="fieldt" type="text" size="8" id="tau02" value="0.000"></td>  
	  <td> <input type="checkbox" id="2" checked="checked"  onclick="change(this)"> </td> </tr>
<tr id=row03> <td>03 </td>
     <td> <input class="fieldp" type="text" size="8" id="polarity03" value="0"> </td>
	  <td> <input class="fieldo" type="text" size="8" id="offset03" value="0.000"> </td>
     <td> <input class="fielda" type="text" size="8" id="again03" value="0.000"> </td>
	  <td> <input class="fieldd" type="text" size="8" id="dgain03" value="0.000">  </td>
	  <td> <input class="fieldt" type="text" size="8" id="tau03" value="0.000"></td> 
	  <td> <input type="checkbox" id="3" checked="checked"  onclick="change(this)"> </td> </tr>
<tr id=row04> <td>04</td>
     <td> <input class="fieldp" type="text" size="8" id="polarity04" value="0"> </td>
	  <td> <input class="fieldo" type="text" size="8" id="offset04" value="0.000"></td>
     <td> <input class="fielda" type="text" size="8" id="again04" value="0.000"></td>
	  <td> <input class="fieldd" type="text" size="8" id="dgain04" value="0.000">  </td>
	  <td> <input class="fieldt" type="text" size="8" id="tau04" value="0.000"></td> 
	  <td> <input type="checkbox" id="4" checked="checked"  onclick="change(this)">  </td> </tr>
<tr id=row05> <td>05</td>
     <td> <input class="fieldp" type="text" size="8" id="polarity05" value="0"> </td>
	  <td> <input class="fieldo" type="text" size="8" id="offset05" value="0.000">  </td>
     <td> <input class="fielda" type="text" size="8" id="again05" value="0.000"> </td>
	  <td> <input class="fieldd" type="text" size="8" id="dgain05" value="0.000">  </td>
	  <td> <input class="fieldt" type="text" size="8" id="tau05" value="0.000"></td> 
	  <td> <input type="checkbox" id="5" checked="checked"  onclick="change(this)"> </td> </tr>
<tr id=row06> <td>06</td>
     <td> <input class="fieldp" type="text" size="8" id="polarity06" value="0"> </td>
	  <td> <input class="fieldo" type="text" size="8" id="offset06" value="0.000">  </td>
     <td> <input class="fielda" type="text" size="8" id="again06" value="0.000"> </td>
	  <td> <input class="fieldd" type="text" size="8" id="dgain06" value="0.000">  </td>
	  <td> <input class="fieldt" type="text" size="8" id="tau06" value="0.000"></td> 
	  <td> <input type="checkbox" id="6" checked="checked"  onclick="change(this)"> </td> </tr>
<tr id=row07> <td>07</td>
     <td> <input class="fieldp" type="text" size="8" id="polarity07" value="0"> </td>
	  <td> <input class="fieldo" type="text" size="8" id="offset07" value="0.000"> </td>
     <td> <input class="fielda" type="text" size="8" id="again07" value="0.000"> </td>
	  <td> <input class="fieldd" type="text" size="8" id="dgain07" value="0.000">  </td>
	  <td> <input class="fieldt" type="text" size="8" id="tau07" value="0.000"></td>  
	  <td> <input type="checkbox" id="7" checked="checked"  onclick="change(this)">  </td> </tr>

 </table>



<script type="text/javascript">

 

  var g2 = new Dygraph(
    document.getElementById("graphdiv2"),
    "ADC.csv", // path to CSV file
    {   // graph options
	  title: ' ',
	  colors:
            ["Navy", "Maroon",    "DarkMagenta", "Black", 
             "Blue", "Red",       "BlueViolet",  "Green", 
             "Teal", "Darkorange","Fuchsia",     "Olive" ,
				 "Aqua", "Gold",      "Gray",        "Lime" ], 
	  ylabel: 'ADC value',
	  xlabel: 'Sample number',          
	  labelsDiv: document.getElementById('legend'),
     legend: 'always',
	  visibility: [true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true]
	 }
  );

    function change(el) {
     	g2.setVisibility(el.id, el.checked);
	  }

      var graphs = [ g2 ];
      function showall(val) {
         for (var idx = 0; idx < graphs.length; idx++) {	  
            graphs[idx].updateOptions({ 	  visibility: [val, val, val, val, val, val, val, val, val, val, val, val, val, val, val, val] });
         }
		};


</script>



    <p><b>Show More on Plot</b> 
    <p>
		<input type="checkbox" id="8" checked="checked"  onclick="change(this)">
      <label for="8"> adc08 </label>
      <input type="checkbox" id="9" checked="checked" onclick="change(this)">
      <label for="9"> adc09 </label>
      <input type="checkbox" id="10" checked="checked" onclick="change(this)">
      <label for="10"> adc10 </label>
		<input type="checkbox" id="11" checked="checked" onclick="change(this)">
      <label for="11"> adc11 </label><br>

		<input type="checkbox" id="12" checked="checked"  onclick="change(this)">
      <label for="12"> adc12 </label>
      <input type="checkbox" id="13" checked="checked" onclick="change(this)">
      <label for="13"> adc13 </label>
      <input type="checkbox" id="14" checked="checked" onclick="change(this)">
      <label for="14"> adc14 </label>
		<input type="checkbox" id="15" checked="checked" onclick="change(this)">
      <label for="15"> adc15 </label><br>
    </p>
	 	 <input id='showall' type="button" value="Show All" onclick="showall(true)">
	 <input id='showall' type="button" value="Hide All" onclick="showall(false)"></p>



 </div>


<p>Double click to auto zoom </p>
<p>Click and drag to zoom </p>
<p>Alt click and drag to pan </p>
<p>Roughly 500 nanoseconds between samples </p>



</body>
</html>





